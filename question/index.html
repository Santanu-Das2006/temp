<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://quizzy-quest.onrender.com/image/logo.png"
    />
    <title>Quiz</title>
    <style>
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }
      body {
        height: 100vh;
        background-size: 100% 100%;
        position: relative;
        overflow: hidden;
      }
      .spiner {
        width: 100%;
        position: absolute;
        background-color: #484747;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 100;
      }
      .loader {
        transform: rotateZ(45deg);
        perspective: 1000px;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        color: #fff;
      }
      .loader:before,
      .loader:after {
        content: "";
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: inherit;
        height: inherit;
        border-radius: 50%;
        transform: rotateX(70deg);
        animation: 1s spin linear infinite;
      }
      .loader:after {
        color: #ff3d00;
        transform: rotateY(70deg);
        animation-delay: 0.4s;
      }

      @keyframes rotate {
        0% {
          transform: translate(-50%, -50%) rotateZ(0deg);
        }
        100% {
          transform: translate(-50%, -50%) rotateZ(360deg);
        }
      }

      @keyframes rotateccw {
        0% {
          transform: translate(-50%, -50%) rotate(0deg);
        }
        100% {
          transform: translate(-50%, -50%) rotate(-360deg);
        }
      }

      @keyframes spin {
        0%,
        100% {
          box-shadow: 0.2em 0px 0 0px currentcolor;
        }
        12% {
          box-shadow: 0.2em 0.2em 0 0 currentcolor;
        }
        25% {
          box-shadow: 0 0.2em 0 0px currentcolor;
        }
        37% {
          box-shadow: -0.2em 0.2em 0 0 currentcolor;
        }
        50% {
          box-shadow: -0.2em 0 0 0 currentcolor;
        }
        62% {
          box-shadow: -0.2em -0.2em 0 0 currentcolor;
        }
        75% {
          box-shadow: 0px -0.2em 0 0 currentcolor;
        }
        87% {
          box-shadow: 0.2em -0.2em 0 0 currentcolor;
        }
      }

      video {
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
      }
      .start-screen,
      button {
        border: none;
        outline: none;
        cursor: pointer;
      }
      #start-button,
      #restart {
        font-size: 1.3em;
        padding: 0.5em 1.8em;
        border-radius: 0.2em;
        box-shadow: 0 20px 30px rgba(0, 0, 0, 0.4);
      }
      #restart {
        margin-top: 0.9em;
      }
      #display-container {
        background-color: transparent;
        backdrop-filter: blur(5px);
        padding: 3.1em 1.8em;
        width: 80%;
        max-width: 37.5em;
        margin: 0 auto;
        position: absolute;
        transform: translate(-50%, -50%);
        top: 50%;
        left: 50%;
        border-radius: 0.6em;
      }
      .header {
        margin-bottom: 1.8em;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 0.6em;
        color: #fff;
        border-bottom: 0.1em solid #000;
      }
      .timer-div {
        background-color: #e1f5fe;
        width: 7.5em;
        color: #000;
        border-radius: 1.8em;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.7em 1.8em;
      }
      .clock{
        width: 20px;
        height: 20px;
      }
      .question {
        margin-bottom: 1.25em;
        font-weight: 600;
        color: #fff;
      }
      .option-div {
        font-size: 0.9em;
        width: 100%;
        padding: 1em;
        margin: 0.3em 0;
        color: #fff;
        text-align: left;
        outline: none;
        background: transparent;
        border: 1px solid #000;
        border-radius: 0.3em;
      }
      .option-div:disabled {
        color: #000000;
        cursor: not-allowed;
      }
      #next-button {
        font-size: 1em;
        margin-top: 1.5em;
        background-color: #000;
        color: #ffffff;
        padding: 0.7em 1.8em;
        border-radius: 0.3em;
        float: right;
        box-shadow: 0px 20px 40px rgba(0, 0, 0, 0.3);
      }
      .hide {
        display: none;
      }
      .incorrect {
        border-width: 2px;
        border-color: #d32f2f;
      }
      .correct {
        border-width: 2px;
        border-color: #8aff24;
      }
      #user-score {
        font-size: 1.5em;
        color: #ffffff;
      }
      :root {
        --result-color: rgb(226, 222, 70);
      }
      .dark {
        width: 100%;
        height: 100%;
        position: absolute;
        opacity: 0.3;
      }
      .div {
        width: 800px;
        height: 700px;
        position: relative;
        background-color: #fff;
        border-radius: 25px;
      }
      .inner-div {
        width: 100%;
        height: 60%;
        border-radius: 25px;
        background: linear-gradient(
          8deg,
          rgba(255, 255, 255, 1) 0%,
          rgba(255, 255, 255, 1) 33%,
          var(--result-color) 33%,
          var(--result-color) 33%,
          var(--result-color) 90%
        );
        display: flex;
        justify-content: end;
        align-items: center;
      }
      .text-wrap {
        padding-right: 4%;
        text-align: center;
        padding-bottom: 9%;
      }
      .text-wrap h1 {
        font-size: 50px;
        font-family: Verdana, Geneva, Tahoma, sans-serif;
        color: #fff;
      }
      .text-wrap p {
        font-size: 24px;
        color: #fff;
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
          sans-serif;
      }
      .image {
        position: absolute;
        width: 220px;
        height: 220px;
        border-radius: 50%;
        background-color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        left: 5%;
        top: 18%;
        z-index: 10;
        box-shadow: 2px 2px 10px black;
      }
      img {
        width: 200px;
      }
      .img-wrap img {
        width: 80px;
      }
      .begain {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background-color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        left: 5%;
        top: 18%;
        box-shadow: 2px 2px 10px black;
      }
      .begain-wrap {
        width: 100%;
        height: auto;
      }
      .begain-wrap p {
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
          sans-serif;
        font-size: 30px;
        font-weight: 600;
        display: flex;
        color: var(--result-color);
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      .img-wrap {
        margin-top: 4.5%;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10%;
      }
      .btn-wrap {
        margin-top: 4%;
        width: 100%;
        height: auto;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .restart {
        padding: 8px 40px;
        border-radius: 10px;
        border: none;
        font-size: 18px;
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
          sans-serif;
        font-weight: 600;
        color: #fff;
        letter-spacing: 2px;
        background-color: var(--result-color);
      }
      .result {
        /* width: 100%;
        height: 100%; */
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
      }
      .resultClick {
        padding: 8px 40px;
        border: 1px solid black;
        cursor: pointer;
      }
      @media (max-width: 700px) {
        .text-wrap h1 {
          font-size: 30px;
          z-index: 100;
        }
        .text-wrap {
          font-size: 18px;
          z-index: 99;
        }
        .image {
          width: 180px;
          height: 180px;
          top: 12%;
        }
        .image img {
          width: 160px;
        }
        .text-wrap {
          z-index: 101;
          position: absolute;
          top: 45%;
          left: 15%;
        }
        .text-wrap p,
        .text-wrap h1 {
          color: #000;
        }
        .inner-div {
          height: 40%;
        }
        .begain-wrap {
          margin-top: 40%;
        }
        .img-wrap .begain {
          width: 60px;
          height: 60px;
        }
        .begain-wrap .begain img {
          width: 50px;
        }
        .btn-wrap {
          margin-top: 5%;
        }
      }
    </style>
  </head>
  <body>
    <div class="spiner">
      <span class="loader"></span>
    </div>
    <div class="result">
      <div class="dark"></div>
      <div class="div">
        <div class="image">
          <img src="./img/easy/1_3.png" />
        </div>

        <div class="inner-div">
          <div class="text-wrap">
            <h1>You are <span>Yagami</span></h1>
            <p>You correct <span>3</span> quisten out of 10</p>
          </div>
        </div>
        <div class="begain-wrap">
          <p>PLay again to be a</p>
          <div class="img-wrap">
          </div>
        </div>
        <div class="btn-wrap">
          <button class="restart">Restart</button>
        </div>
      </div>
    </div>
    <video
      src="./Day and Night Cycle Parallax Background.mp4"
      id="bg-v"
      autoplay
      muted
      loop
    ></video>
    <div id="display-container">
      <div class="header">
        <div class="number-of-count">
          <span class="number-of-question">1 of 3 questions</span>
        </div>
        <div class="timer-div">
          <img
            src="./stopwatch-icon.png"
            class="clock"
          />
          <span class="time-left">10s</span>
        </div>
      </div>
      <div id="container">
        <!-- questions and options will be displayed here -->
      </div>
      <button id="next-button">Next</button>
    </div>
    <script>
      let result = document.querySelector('.result')
      result.style.display = 'none'
      function resultPage(diffs, point) {
        function totalUi(point) {
          if (
            (correct >= 0 && correct <= 3) ||
            (correct >= "0" && correct <= "3")
          ) {
            return 0;
          } else if (correct >= "4" && correct <= "6") {
            return 1;
          } else if (correct >= "7" && correct <= "9") {
            return 2;
          } else if (correct == 10 || correct == "10") {
            return 3;
          }
        }

        function createImg(diff, i) {
          let div = document.createElement("div");
          div.classList.add("begain");
          let img = document.createElement("img");
          img.src = `./img/${diff}/${imgArray[i]}.png`;
          div.appendChild(img);
          return div;
        }

        let imgArray = ["1_3", "4_6", "7_9", "10"];
        let easy = [
          { name: "Naruto", color: "rgb(226, 222, 70)" },
          { name: "Kakashi", color: "rgb(56, 53, 58)" },
          { name: "Itachi", color: "rgb(56, 24, 66)" },
          { name: "Madara", color: "rgb(128, 47, 54)" },
        ];
        let medium = [
          { name: "Luffy", color: "rgb(239, 169, 37)" },
          { name: "Boruto", color: "rgb(231, 103, 136)" },
          { name: "Tanjiro", color: "rgb(36, 73, 95)" },
          { name: "Yagami", color: "rgb(21, 20, 25)" },
        ];
        let hard = [
          { name: "Gojo", color: "rgb(100, 128, 147)" },
          { name: "Beerus", color: "rgb(216, 157, 216)" },
          { name: "Vegita", color: "rgb(252, 46, 251)" },
          { name: "Goku", color: "rgb(30, 51, 149)" },
        ];
        let difficulty = diffs;
        let correct = point;
        let getPoint = totalUi(correct);
        let you = document.querySelector(".text-wrap h1 span");
        let rite = document.querySelector(".text-wrap p span");
        let mainImg = document.querySelector(".image img");
        let imgWrap = document.querySelector(".img-wrap");
        const root = document.documentElement;
          rite.innerHTML = correct;
          if (difficulty == "easy") {
            you.innerHTML = easy[getPoint].name;
            mainImg.src = `./img/easy/${imgArray[getPoint]}.png`;
            for (let i = getPoint + 1; i < 4; i++) {
              let obj = createImg(difficulty, i);
              imgWrap.appendChild(obj);
            }
            root.style.setProperty("--result-color", easy[getPoint].color);
          } else if (difficulty == "medium") {
            you.innerHTML = medium[getPoint].name;
            mainImg.src = `./img/medium/${imgArray[getPoint]}.png`;
            for (let i = getPoint + 1; i < 4; i++) {
              let obj = createImg(difficulty, i);
              imgWrap.appendChild(obj);
            }
            root.style.setProperty("--result-color", medium[getPoint].color);
          } else if (difficulty == "hard") {
            you.innerHTML = hard[getPoint].name;
            mainImg.src = `./img/hard/${imgArray[getPoint]}.png`;
            for (let i = getPoint + 1; i < 4; i++) {
              let obj = createImg(difficulty, i);
              imgWrap.appendChild(obj);
            }
            root.style.setProperty("--result-color", hard[getPoint].color);
          }
        }
      //References
      let timeLeft = document.querySelector(".time-left");
      let quizContainer = document.getElementById("container");
      let nextBtn = document.getElementById("next-button");
      let countOfQuestion = document.querySelector(".number-of-question");
      let displayContainer = document.getElementById("display-container");

      let restart = document.querySelector(".restart");
      let userScore = document.getElementById("user-score");
      let questionCount;
      let scoreCount = 0;
      let count = 11;
      let countdown;
      let check = undefined;
      const PORT = "https://quizzy-quest.onrender.com";
      //Questions and Options array
      const quizArray = [];

      // Function to fetch quiz data asynchronously
      async function fetchQuizData() {
        try {
          let difficulty = localStorage.getItem("difficulty");
          let category = localStorage.getItem("option");
          let response = await fetch(
            `https://opentdb.com/api.php?amount=10&category=${category}&difficulty=${difficulty}&type=multiple`
          );
          let data = await response.json();
          return data.results;
        } catch (error) {
          return null;
        }
      }

      function decodeHTMLEntities(text) {
        const textarea = document.createElement("textarea");
        textarea.innerHTML = text;
        return textarea.value;
      }
      // Function to initialize the quiz
      async function initializeQuiz() {
        // Fetch quiz data
        let quizData = await fetchQuizData();
        if (!quizData) window.location.reload(); // Exit if fetching failed

        // Process fetched data
        quizData.forEach((data, index) => {
          let options = [...data.incorrect_answers, data.correct_answer];
          options.sort(() => Math.random() - 0.5); // Shuffle options
          quizArray.push({
            id: index,
            question: decodeHTMLEntities(data.question), // Decode HTML entities
            options: options.map((option) => decodeHTMLEntities(option)), // Decode HTML entities
            correct: decodeHTMLEntities(data.correct_answer), // Decode HTML entities
          });
        });
        displayContainer.classList.add("hide");
        start();
        document.querySelector(".spiner").style.display = "none";
      }
      restart.addEventListener("click", () => {
        const clear = ""
        localStorage.setItem('option', clear)
        localStorage.setItem('dif', clear)
        window.location.href = `../index.html`;
      });

      // Event listener for next button
      nextBtn.addEventListener("click", () => {
        displayNext();
      });

      // Function to display next question or score
      function displayNext(a = check) {
        if (a != undefined) {
          questionCount++;
          if (questionCount === quizArray.length) {
            displayContainer.classList.add('hide')
            difi = localStorage.getItem("dif");
            resultPage(difi, scoreCount);
            result.style.display = 'block'
            localStorage.setItem("difficulty", "");
            localStorage.setItem("option", "");
          } else {
            countOfQuestion.textContent =
              questionCount + 1 + " of " + quizArray.length + " Question";
            quizDisplay(questionCount);
            count = 11;
            clearInterval(countdown);
            timerDisplay();
          }
          check = undefined;
        }
      }

      // Function to display timer
      function timerDisplay() {
        countdown = setInterval(() => {
          count--;
          timeLeft.textContent = `${count}s`;
          if (count == 0) {
            clearInterval(countdown);
            displayNext("as");
          }
        }, 1000);
      }

      // Function to display quiz
      function quizDisplay(questionCount) {
        let quizCards = document.querySelectorAll(".container-mid");
        quizCards.forEach((card) => {
          card.classList.add("hide");
        });
        quizCards[questionCount].classList.remove("hide");
      }

      // Function to check user's answer
      function checker(userOption) {
        let userSolution = userOption.innerText;
        let question =
          document.getElementsByClassName("container-mid")[questionCount];
        let options = question.querySelectorAll(".option-div");

        if (userSolution === quizArray[questionCount].correct) {
          userOption.classList.add("correct");
          scoreCount++;
        } else {
          userOption.classList.add("incorrect");
          options.forEach((element) => {
            if (element.innerText == quizArray[questionCount].correct) {
              element.classList.add("correct");
            }
          });
        }
        clearInterval(countdown);
        options.forEach((element) => {
          element.disabled = true;
        });
      }

      // Function to create quiz questions
      function quizCreator() {
        // Shuffle questions
        quizArray.sort(() => Math.random() - 0.5);

        // Create quiz questions
        quizArray.forEach((questionData, index) => {
          let div = document.createElement("div");
          div.classList.add("container-mid", "hide");

          // Set question number
          countOfQuestion.textContent =
            index + 1 + " of " + quizArray.length + " Question";

          // Set question
          let questionDiv = document.createElement("p");
          questionDiv.classList.add("question");
          questionDiv.textContent = questionData.question;
          div.appendChild(questionDiv);

          // Set options
          questionData.options.forEach((option) => {
            let optionButton = document.createElement("button");
            optionButton.classList.add("option-div");
            optionButton.textContent = option;
            optionButton.onclick = function () {
              checker(this);
            };
            div.appendChild(optionButton);
          });

          quizContainer.appendChild(div);
        });
      }

      // Function to initialize the quiz
      function initial() {
        quizContainer.innerHTML = "";
        questionCount = 0;
        scoreCount = 0;
        count = 11;
        clearInterval(countdown);
        timerDisplay();
        quizCreator();
        quizDisplay(questionCount);

        let checkOption = document.querySelectorAll(".option-div");
        checkOption.forEach((item) => {
          item.addEventListener("click", (e) => {
            check = e.target.textContent;
          });
        });
      }

      // Event listener for start button
      function start() {
        displayContainer.classList.remove("hide");
        initial();
        countOfQuestion.textContent = "1 of " + quizArray.length + " Question";
      }

      // Window load event
      window.onload = () => {
        initializeQuiz();
      };
    </script>
  </body>
</html>
